# ç¼–è¯‘æ–‡ä»¶æ¸…å•

## ğŸ“¦ éœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶

### å¿…éœ€æ–‡ä»¶ï¼ˆæ ¸å¿ƒæ–‡ä»¶ï¼‰

```
WeChat_tweak-master/WeChatPluginDev/wapleodtcorexpc/
â”œâ”€â”€ Makefile                                    â­ ç¼–è¯‘é…ç½®æ–‡ä»¶
â”œâ”€â”€ control                                     â­ åŒ…ä¿¡æ¯æ–‡ä»¶
â”œâ”€â”€ wapleodtcorexpc.plist                       â­ æ’ä»¶é…ç½®æ–‡ä»¶
â””â”€â”€ src/                                        â­ æºä»£ç ç›®å½•
    â”œâ”€â”€ Tweak.xm                                â­â­â­ ä¸»è¦ Hook ä»£ç ï¼ˆåŒ…å«è‡ªåŠ¨å›å¤ï¼‰
    â”œâ”€â”€ WeChatRedEnvelop.h                      â­â­ å¾®ä¿¡ç±»å£°æ˜
    â”œâ”€â”€ WeChatRedEnvelopParam.h
    â”œâ”€â”€ WeChatRedEnvelopParam.m
    â”œâ”€â”€ WCPLAutoReplyConfig.h                   â­â­â­ æ–°å¢ï¼šè‡ªåŠ¨å›å¤é…ç½®å¤´æ–‡ä»¶
    â”œâ”€â”€ WCPLAutoReplyConfig.m                   â­â­â­ æ–°å¢ï¼šè‡ªåŠ¨å›å¤é…ç½®å®ç°
    â”œâ”€â”€ WCPLSettingViewController.h
    â”œâ”€â”€ WCPLSettingViewController.m
    â”œâ”€â”€ WCPLReceiveRedEnvelopOperation.h
    â”œâ”€â”€ WCPLReceiveRedEnvelopOperation.m
    â”œâ”€â”€ WCPLRedEnvelopTaskManager.h
    â”œâ”€â”€ WCPLRedEnvelopTaskManager.m
    â”œâ”€â”€ WCPLRedEnvelopConfig.h
    â”œâ”€â”€ WCPLRedEnvelopConfig.m
    â”œâ”€â”€ WCPLRedEnvelopParamQueue.h
    â”œâ”€â”€ WCPLRedEnvelopParamQueue.m
    â”œâ”€â”€ WCPLNewFuncAddition.h
    â”œâ”€â”€ WCPLFuncService.h
    â”œâ”€â”€ WCPLFuncService.m
    â”œâ”€â”€ WCPLBaseViewController.h
    â”œâ”€â”€ WCPLBaseViewController.m
    â”œâ”€â”€ WCPLMultiSelectGroupsViewController.h
    â”œâ”€â”€ WCPLMultiSelectGroupsViewController.m
    â”œâ”€â”€ WCPLAVManager.h
    â””â”€â”€ WCPLAVManager.m
```

## ğŸ“‹ æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶è¯´æ˜

### â­â­â­ æ ¸å¿ƒæ–°å¢æ–‡ä»¶ï¼ˆå¿…é¡»ä¸Šä¼ ï¼‰

| æ–‡ä»¶å | è¯´æ˜ | é‡è¦æ€§ |
|--------|------|--------|
| `src/WCPLAutoReplyConfig.h` | è‡ªåŠ¨å›å¤é…ç½®å¤´æ–‡ä»¶ | å¿…éœ€ |
| `src/WCPLAutoReplyConfig.m` | è‡ªåŠ¨å›å¤é…ç½®å®ç° | å¿…éœ€ |
| `src/Tweak.xm` | å·²ä¿®æ”¹ï¼Œæ·»åŠ è‡ªåŠ¨å›å¤åŠŸèƒ½ | å¿…éœ€ |
| `src/WeChatRedEnvelop.h` | å·²ä¿®æ”¹ï¼Œæ·»åŠ æ–¹æ³•å£°æ˜ | å¿…éœ€ |
| `Makefile` | å·²ä¿®æ”¹ï¼Œæ·»åŠ æ–°æ–‡ä»¶ç¼–è¯‘ | å¿…éœ€ |

### ğŸ“ å®Œæ•´çš„ä¸Šä¼ ç›®å½•ç»“æ„

å»ºè®®ç›´æ¥ä¸Šä¼ æ•´ä¸ª `wapleodtcorexpc` æ–‡ä»¶å¤¹åˆ°æœåŠ¡å™¨ï¼š

```bash
# åœ¨å®å¡”é¢æ¿ä¸­ï¼š
/www/wwwroot/WeChat_tweak-master/WeChatPluginDev/wapleodtcorexpc/
```

## ğŸš€ ç¼–è¯‘æ­¥éª¤

### 1. ä¸Šä¼ æ–‡ä»¶

```bash
# æ–¹å¼1ï¼šä½¿ç”¨å®å¡”é¢æ¿
# 1. æ‰“åŒ…æ•´ä¸ª wapleodtcorexpc æ–‡ä»¶å¤¹ä¸º .zip
# 2. é€šè¿‡å®å¡”é¢æ¿ä¸Šä¼ åˆ° /www/wwwroot/WeChat_tweak-master/WeChatPluginDev/
# 3. è§£å‹

# æ–¹å¼2ï¼šä½¿ç”¨ SCPï¼ˆå¦‚æœé…ç½®äº†SSHï¼‰
scp -r wapleodtcorexpc kali@è™šæ‹ŸæœºIP:/www/wwwroot/WeChat_tweak-master/WeChatPluginDev/
```

### 2. è®¾ç½®æƒé™

```bash
ssh kali@è™šæ‹ŸæœºIP

cd /www/wwwroot/WeChat_tweak-master/WeChatPluginDev/wapleodtcorexpc
sudo chown -R kali:kali .
chmod +x Makefile
```

### 3. ç¼–è¯‘

```bash
# æ¸…ç†æ—§æ–‡ä»¶
make clean

# ç¼–è¯‘
make

# å¦‚æœéœ€è¦æ‰“åŒ…æˆ .deb
make package
```

### 4. æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶

```bash
# æŸ¥çœ‹ dylib æ–‡ä»¶
ls -lh .theos/obj/debug/

# è¾“å‡ºç¤ºä¾‹ï¼š
# -rw-r--r-- 1 kali kali 156K Nov 1 16:30 wapleodtcorexpc.dylib

# æŸ¥çœ‹ deb åŒ…ï¼ˆå¦‚æœæ‰§è¡Œäº† make packageï¼‰
ls -lh packages/

# è¾“å‡ºç¤ºä¾‹ï¼š
# -rw-r--r-- 1 kali kali 85K Nov 1 16:30 com.aple.wapleodtcorexpc_0.0.1-1+debug_iphoneos-arm.deb
```

## ğŸ“¥ ä¸‹è½½ç¼–è¯‘äº§ç‰©

### é€šè¿‡å®å¡”é¢æ¿ä¸‹è½½

```
è·¯å¾„ï¼š/www/wwwroot/WeChat_tweak-master/WeChatPluginDev/wapleodtcorexpc/.theos/obj/debug/
æ–‡ä»¶ï¼šwapleodtcorexpc.dylib
```

### é€šè¿‡ SCP ä¸‹è½½

```bash
scp kali@è™šæ‹ŸæœºIP:/www/wwwroot/WeChat_tweak-master/WeChatPluginDev/wapleodtcorexpc/.theos/obj/debug/wapleodtcorexpc.dylib ~/Desktop/
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¡®ä¿ Theos å·²å®‰è£…**
   ```bash
   ls /opt/theos
   ```

2. **ç¡®ä¿ iOS SDK å·²å®‰è£…**
   ```bash
   ls /opt/theos/sdks/*.sdk
   ```

3. **å¦‚æœç¼–è¯‘å‡ºé”™**ï¼ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼š
   - ç¼ºå°‘å¤´æ–‡ä»¶ï¼šæ£€æŸ¥æ‰€æœ‰ .h æ–‡ä»¶æ˜¯å¦ä¸Šä¼ 
   - è¯­æ³•é”™è¯¯ï¼šæ£€æŸ¥ä»£ç æ˜¯å¦å®Œæ•´
   - æƒé™é—®é¢˜ï¼šè¿è¡Œ `sudo chown -R $USER:$USER .`

## ğŸ¯ å…³é”®è¯é…ç½®è¯´æ˜

ç¼–è¯‘æˆåŠŸåï¼Œæ’ä»¶å†…ç½®äº†ä»¥ä¸‹é»˜è®¤å…³é”®è¯ï¼š

| å…³é”®è¯ | å›å¤ç±»å‹ | å›å¤å†…å®¹ |
|--------|---------|---------|
| ä½ å¥½ | æ–‡æœ¬ | æ‚¨å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼ŸğŸ˜Š |
| åœ¨å— | æ–‡æœ¬ | åœ¨çš„ï¼Œè¯·é—®æœ‰ä»€ä¹ˆäº‹æƒ…ï¼Ÿ |
| ä»·æ ¼è¡¨ | å›¾ç‰‡ | https://example.com/price.jpg |

### ä¿®æ”¹å…³é”®è¯

ç¼–è¾‘ `src/WCPLAutoReplyConfig.m` æ–‡ä»¶çš„ `addDefaultRules` æ–¹æ³•ï¼š

```objc
- (void)addDefaultRules {
    // æ·»åŠ è‡ªå®šä¹‰è§„åˆ™
    WCPLAutoReplyRule *rule = [[WCPLAutoReplyRule alloc] init];
    rule.keyword = @"ä½ çš„å…³é”®è¯";
    rule.replyType = WCPLReplyType_Text;  // æˆ– WCPLReplyType_Image
    rule.replyContent = @"å›å¤å†…å®¹æˆ–å›¾ç‰‡URL";
    rule.delaySeconds = 2;  // å»¶è¿Ÿç§’æ•°
    [_rules addObject:rule];
}
```

é‡æ–°ç¼–è¯‘å³å¯ã€‚

## âœ… éªŒè¯ç¼–è¯‘æ˜¯å¦æˆåŠŸ

```bash
# æŸ¥çœ‹æ–‡ä»¶å¤§å°ï¼ˆåº”è¯¥å¤§äº100KBï¼‰
ls -lh .theos/obj/debug/wapleodtcorexpc.dylib

# æŸ¥çœ‹æ”¯æŒçš„æ¶æ„
lipo -info .theos/obj/debug/wapleodtcorexpc.dylib
# åº”è¯¥è¾“å‡ºï¼šArchitectures in the fat file: arm64

# æŸ¥çœ‹ä¾èµ–åº“
otool -L .theos/obj/debug/wapleodtcorexpc.dylib
```

ç¼–è¯‘æˆåŠŸï¼ğŸ‰

